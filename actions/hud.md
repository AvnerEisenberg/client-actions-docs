# Show HUD 
Showing a progress HUD (Heads Up Display).

## Description
 It's helpful to give the user an indication that something is happening now,
performing web requests or computing any computations that takes a long time. \
The HUD can show a ```Message``` on the indicator.\
In addition, the HUD can show a button that allow the user to close the HUD. the button will be shown only if ```CancelMessage``` text is provided.
Once the Cancel Button is pressed, the client should close the hud and emit-event with ```CancelEventKey``` without data.

the action has 3 states. 
* Show 
    - the client should show the HUD on the screen for an ```Interval``` time
* Poll
    - the client still showing the HUD for an additional ```Interval``` time
* Hide
    - the client should hide the HUD immidaly    



HUD lifecycle diagram:
```                  
                       client action
                      +--------------+
                      |              |
                      |  Polling...  |
                      |              |
                      +---+----------+
                          |     ^
                          |     |
                          |     |
client action             v     |          client action
+-------------+        xxxxxxxxxxxx       +--------------+
|             |       x            x      |              |
|  Show HUD   +------>x working... x----->|   Hide HUD   |
|             |       x            x      |              |
+-------------+        xxxxxxxxxxxx       +--------------+
                        user's code
```

client action


### Parameters:

#### ```State```
The state of the HUD action (mandatory). 
#### ```Message```
The message that will be seen on the HUD (optional). 
#### ```CancelMessage```
The Cancel Message that will be seen on the HUD's cancel button (optional). 
#### ```CancelEventKey```
The event key that the client will emit to after the HUD's cancel button was pressed (mandatory if ```CancelMessage``` is provided). 
#### ```Interval```
The client should poll the emit-event loop after interval time (in seconds), mandatory in both 'Show' and 'Poll' states.
The client should do so using the CallbackKey of this action. 
#### ```Key```
The client should generate this key as a response to show request. further requests on this hud instance ('Poll' or 'Hide') will use this key.
#### ```MiddleClientEventKey```
The client should emit an event to this key just immediately when he got it.\
This allows running client actions inside the HUD block.

### Return Object:
The client will return this object

#### ```Success```
Indicate if the action succeeded.
#### ```HUDKey```
The HUD key generated by the client (will returns only for 'show' request).

## Example

### Request 
#### state: Show
```json
{
    "Type": "HUD",
    "Data": {
        "State": "Show",
        "Message": "Waiting....", //optional
        "CancelMessage": "Press to close", //optional
        "CancelEventKey": "cf980bc7-3f1c-4073-ad41-64568ba4b783",
        "Interval": 0.1,
        "MiddleClientEventKey": "a7363d42-abe8-42ff-8a85-85b775da0109",
    }
}
```
### Response for Show state
```json
{
    "Success": true,
    "HUDKey": "8A6D7F6D-08AD-4386-85CF-35F726F73339"
}

```
#### state: Poll
```json
{
    "Type": "HUD",
    "Data": {
        "HUDKey": "8A6D7F6D-08AD-4386-85CF-35F726F73339",
        "Message": "In progress 27%",
        "State": "Poll",
        "Interval": 0.1,
        "MiddleClientEventKey": "a7363d42-abe8-42ff-8a85-85b775da0109",

    }
}
```
#### state: Hide
```json
{
    "Type": "HUD",
    "Data": {
        "State": "Hide",
        "HUDKey": "8A6D7F6D-08AD-4386-85CF-35F726F73339"
    }
}
```

### Response
```json
{
    "Success": true,
}
```

## Usage
We can show a HUD from the CPI Node like one of the following example.

```typescript

const hudOptions = {
    // HUD's message
    message: 'Waiting....', // optional (default value is '')

    // adds a button with text to the HUD
    cancelMessage: 'Press to close', // optional - (default is '' and the botton is hidden)

    //display the HUD after the delay time (the block runs in the meantime)
    delay: 0.2, //optional - (default value is 0.5)

    //tell the client to poll after after the interval time
    interval: 0.1, // optional - (default value is 0.5)

    // block of code that will run in background while the HUD is showing.
    block: async (updateMessage, client) => {
        // do stuff that takes a long time that needs a HUD
        // for example:
        // You can call any client action you want like this.
        await client.alert('Alert', 'we are ready...');
        for (let i = 0; i < 100; i++) {
            await new Promise((resolve) => setTimeout(resolve, 100));
            // you can update the HUD message while the HUD is showing
            updateMessage(`In progress ${i}%`);
        }
    },
};

const res = await pepperi.client.showHUD(hudOptions);
if (res.canceled) {
    console.log('HUD canceled');
    // do stuff..
    // if HUD canceled res.result will be a Promise of the block result.
    console.log('blockResult :>> ', await res.result);
} else {
    console.log('HUD finished with result :>> ', res.result);
}
```